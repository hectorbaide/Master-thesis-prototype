<!DOCTYPE html>
<html>
    <head>
        <title>Tag Navigation</title>
        <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1 user-scalable=no">  
                
                <link rel="stylesheet" href="refs/style.css">
                <script type="text/javascript" src="refs/jquery-1.9.1.min.js"></script>
                <script type="text/javascript" src="refs/jquery-migrate-1.1.1.js"></script>
                <script type="text/javascript" src="refs/underscore-min.js"></script>
                <script type="text/javascript" src="refs/jquery.mobile-1.3.0.min.js"></script>
                <script type="text/javascript" src="refs/isotope.js"></script>
                <script type="text/javascript" src="BMSelector.js"></script>
                <script type="text/javascript" src="experiments.js"></script>
    </head>
    
<body>
    <div id="UIOverlay">

       <a href="#event" data-rel="popup" data-transition="fade" data-position-to="#window"><div class="right-bar">
            </div></a>

            <a href="#places" data-rel="popup" data-transition="fade" data-position-to="#window"><div class="left-bar">
            </div></a>

            <a href="#subject" data-rel="popup" data-transition="fade" data-position-to="#window"><div class="top-bar">
            </div></a>



            <div id="textOverlay" class="Temp"></div>

            <div id="texts" class="hidden"></div>
    </div>  

    
    <div id="left"></div>
    <div id="right"></div>
    <div id="top"></div>
    

    <div id="Container">

        <div id="GalleryView" class="Temp"></div>

    </div>

    <div id="popButton"><span> < BACK </span></div>
    
    
</body>
    

<script type="text/javascript">

//Main array with images, contains sources for thumb and full, tags and metatags, used to fill all other data needs.
var images = new Array;

images[0] = { 'src': 'photos/000.jpg', 'thumb': 'thumb/000.jpg', 'tags':[''], 'meta':['']};
images[1] = { 'src': 'photos/001.jpg', 'thumb': 'thumb/001.jpg', 'tags':['','OOfood','OOsandwich','SSbremen','SShome','TTdaily']};
images[2] = { 'src': 'photos/002.jpg', 'thumb': 'thumb/002.jpg', 'tags':['','OOfood','OOsalad','SSbremen','SShome','TTdaily']};
images[3] = { 'src': 'photos/003.jpg', 'thumb': 'thumb/003.jpg', 'tags':['','OOfood','OOsalad','bremen','SShome','TTdaily']};
images[4] = { 'src': 'photos/004.jpg', 'thumb': 'thumb/004.jpg', 'tags':['','OOanimal','OObug','SSbremen','SShome','TTdaily']};
images[5] = { 'src': 'photos/005.jpg', 'thumb': 'thumb/005.jpg', 'tags':['','OOgame','SSbremen','SShome','TTdaily','OOdesk']};
images[6] = { 'src': 'photos/006.jpg', 'thumb': 'thumb/006.jpg', 'tags':['','OOflower','SSapensen','TTtrip','TTartistic','TTcloseup']};
images[7] = { 'src': 'photos/007.jpg', 'thumb': 'thumb/007.jpg', 'tags':['','OObuilding','OOmalerschule','SSapensen','TTtrip','TTartistic']};
images[8] = { 'src': 'photos/008.jpg', 'thumb': 'thumb/008.jpg', 'tags':['','OOgrill','SSapensen','TTtrip','TTartistic','TTcloseup']};
images[9] = { 'src': 'photos/009.jpg', 'thumb': 'thumb/009.jpg', 'tags':['','OOflower','SSapensen','TTtrip','TTartistic','TTcloseup']};
images[10] = { 'src': 'photos/010.jpg', 'thumb': 'thumb/010.jpg', 'tags':['','SSstreet','SSbremen','TTartistic','TTcloseup']};

//Variable holding all tags (maybe needed later)
var everyTags = _.pluck(images, "tags");

//Buttons for textual search gallery
var tagButtons = [];

//Variable that holds the selected tags
var tagSelection = [''];

//Logging of the size and values of the selected tags
console.log(tagSelection + " are the values of tagSelection variable");
console.log(tagSelection.length + " is the length of tagSelection variable");

//Variable that holds the array with the selected images
var selection = []; 

//Function to evaluate if picture has both elements, contains logs for events happening within the function.
function detailedEval (imageToEvaluate) {
    var queryNumber = tagSelection.length;
    var innerSelection = [];
        for (var i = tagSelection.length-1; i >= 0; i--) {
            var proof;
            proof = imageToEvaluate.tags.indexOf(tagSelection[i]);
            // console.log("Tag number " + i + " was found!");
            if (proof == -1) {
                // console.log("Tag number " + i + " was not found, image not given")
                return -1;
            } else { console.log ("pass"); };
        };
        console.log("Image contains all tags!")
        // console.log(imageToEvaluate);
        selection.push(imageToEvaluate);

    return innerSelection;
    console.log(innerSelection);
};

console.log("These are the tags " + tagSelection);

//VARIABLE DEFINITIONS
//Variable holding the size of the selection
var selectionSize = selection.length;

//Variable holding all links to selected full size images
var imageLinks = _.pluck(selection, "src");

//Variable holding all links to selected image thumbnails
var imageThumbs = _.pluck(selection, "thumb");

//Variable holding selected tags
var selectedObjectTags = _.pluck(selection, "tags");

//Variable holding total number of objects
var objectTotal = _.size(images)-1;

//Variable holding total number of selected objects
var objectSelected = _.size(selection);

//Percentage of selected objects related to the total
var objectPercent = (objectSelected*100)/objectTotal;

//END OF DEFINITIONS

//Function to evaluate the complete array
function evaluation () {
    // body...
    selection = [];
    selectionSize = undefined;
    imageLinks = undefined;
    imageThumbs = undefined;
    selectedObjectTags = undefined;
    objectTotal = undefined;
    objectSelected = undefined;
    objectPercent = undefined;
    for (var i = images.length - 1; i >= 0; i--) {
    detailedEval(images[i]) };   
    selectionSize = selection.length;
    imageLinks = _.pluck(selection, "src");
    imageThumbs = _.pluck(selection, "thumb");
    selectedObjectTags = _.pluck(selection, "tags");
    objectTotal = _.size(images)-1;
    objectSelected = _.size(selection);
    objectPercent = (objectSelected*100)/objectTotal;
}

//Initial call to evaluation
evaluation();

//Image insert function displayPictures
function displayPictures () {
    evaluation();
    for (var index in imageThumbs) {
    $("#GalleryView").append("<a href=#><img src='" + imageThumbs[index] + "'/ width='155' height='272' border='1'></a>");}
    $("#GalleryView").pop;}
    $("#GalleryView").pop;

//Tag overlay function showTags
var processedOverlay = [];

function showTags () {
    $("#textOverlay").remove;
    // Shows the tags in Selection

    if (tagSelection === ['']) { $("#textOverlay").append("<p>All</p>"); } else{ for (var index in tagSelection) {
    $("#textOverlay").append("<p>" + tagSelection[index] + "</p>");}} };

//Initial call to showTags    
showTags();

//TAG MANIPULATION WITH MENUS

//Declaration of a lot of global variables
var newVar = [];
var stringTags = "";
var metaObject = [];
var metaSpace = [];
var metaTime = [];
var timeList = [];
var timeStringList = "";
var spaceList = [];
var spaceStringList = "";
var objectList = [];
var objectStringList = "";



//Distribution of tags by meta identifiers
function metaDistribution () {

    //Extraction of all the tags in image objects collection
    var allTags = _.pluck(selection, "tags");
    console.log("allTags = " + allTags);

    //Flattening of tag array for manipulations
    var flatTags = _.flatten(allTags);
    console.log("flatTags = " + flatTags);

    //Converting tags to strings for eliminating meta identifiers
    var stringTags = flatTags.toString();
    console.log("stringTags = " + stringTags);

    //Creation of list of tags without meta identifiers
    var rep = /[SOT]/g;
    var n = stringTags.replace(rep,'');
    console.log("stringTags without Metas = " + n)

    //Creation of array containing tags without meta identifiers
    var tArray = stringTags.split(',')
    var nArray = n.split(',');
    var buttonList = _.uniq(nArray);
    console.log(buttonList);

    //Reset variable values
    metaSpace = [];
    metaObject = [];
    metaTime = [];
    //Separate values of the array of tags
    for (var i = flatTags.length - 1; i >= 0; i--) {
    if (flatTags[i].indexOf('TT') !== -1 ) { metaTime.push(flatTags[i]); };
    if (flatTags[i].indexOf('SS') !== -1 ) { metaSpace.push(flatTags[i]); };
    if (flatTags[i].indexOf('OO') !== -1 ) { metaObject.push(flatTags[i]); };   
    //Eliminate duplicates
    spaceList = _.uniq(metaSpace);
    objectList = _.uniq(metaObject);
    timeList = _.uniq(metaTime);}
    //Convert to string for taking away ID values
    spaceStringList = spaceList.toString();
    objectStringList = objectList.toString();
    timeStringList = timeList.toString();
    //Take away ID values
    var tSpaceStringList = spaceStringList.replace(rep,'');
    var tObjectStringList = objectStringList.replace(rep,'');
    var tTimeStringList = timeStringList.replace(rep,'');
    //Reset list arrays stuff to fill them in with the new values
    spaceList = [];
    objectList = [];
    timeList = [];
    //Repopulate arrays and finalize state of finished buttons
    spaceList = tSpaceStringList.split(',');
    objectList = tObjectStringList.split(',');
    timeList = tTimeStringList.split(',');
}

console.log(flatTags);

metaDistribution();

console.log("SPACE tags are " + spaceList);
console.log("OBJECT tags are " + objectList);
console.log("TIME tags are " + timeList);


//Populating menus

function populateMenus () {
    
    $('#top').empty();
    $('#left').empty();
    $('#right').empty();

        for (var i = objectList.length - 1; i >= 0; i--) {
        metaDistribution();
        objectList.sort();
        objectList.reverse();
        $('#top').append('<div class="objects"><tr>' + objectList[i] + '</tr></div>');
    };
        for (var i = spaceList.length - 1; i >= 0; i--) {
        metaDistribution();
        spaceList.sort();
        spaceList.reverse();
        $('#left').append('<div class="spaces"><tr>' + spaceList[i] + '</tr></div>');
    };
        for (var i = timeList.length - 1; i >= 0; i--) {
        metaDistribution();
        timeList.sort();
        timeList.reverse();
        $('#right').append('<div class="time"><tr>' + timeList[i] + '</tr></div>');
    };
}

populateMenus();


//Refresh function (show and hide things after clicks)
function refresh() {
    $("#GalleryView").empty();
    $("#textOverlay").empty();
    displayPictures();
    showTags();
}

//Back button callback function, takes away the last added element and refreshes
function backButton() {
    tagSelection.pop();
    tagSelection = _.uniq(tagSelection);
    refresh();
    metaDistribution();
    populateMenus();
}

//Execution of the function
$(function() {
                $( "#popButton" ).on( 'tap', tapHandler );
                function tapHandler( event ) {
                backButton();}
                  });

     $('GalleryView').isotope();

//SuperClick function for tag based navigation for objects
    $("#top").on("click",".objects", function(event){
        tagSelection.push('OO' + $(this).text());
        tagSelection = _.uniq(tagSelection);
        $("#top").fadeOut();
        refresh();
        metaDistribution();
        populateMenus();
        
    });

//SuperClick function for tag based navigation for objects
    $("#left").on("click",".spaces", function(event){
        tagSelection.push('SS' + $(this).text());
        tagSelection = _.uniq(tagSelection);
        $("#left").fadeOut();
        refresh();
        metaDistribution();
        populateMenus();
        
    });

//SuperClick function for tag based navigation for objects
    $("#right").on("click", ".time", function(event){
        tagSelection.push('TT' + $(this).text());
        tagSelection = _.uniq(tagSelection);
        $("#right").fadeOut();
        refresh();
        metaDistribution();
        populateMenus();   
    });

//Initial state hide menus

    $("#top").hide();
    $("#left").hide();
    $("#right").hide();

//Click show and hide menus

    $(".top-bar").on("click", function(event){
        $("#top").fadeToggle(150);
        $("#left").hide();
        $("#right").hide();
    });

    $(".left-bar").on("click", function(event){
        $("#left").fadeToggle(150);
        $("#top").hide();
        $("#right").hide();
    });

    $(".right-bar").on("click", function(event){
        $("#right").fadeToggle(150);
        $("#left").hide();
        $("#top").hide();
    });

// Initialization of gallery 

refresh();

</script> 



</html>